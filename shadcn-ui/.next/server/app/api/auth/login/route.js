"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4695:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>j,originalPathname:()=>v,patchFetch:()=>k,requestAsyncStorage:()=>f,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>q});var n={};r.r(n),r.d(n,{POST:()=>g,dynamic:()=>h,runtime:()=>m});var a=r(9462),o=r(5345),s=r(7143),i=r(2969);let u=require("bcrypt");var l=r.n(u),c=r(636);async function p(e,t){try{let r=await (0,c.I)("SELECT id, username, password_hash, role, full_name FROM employees WHERE username = $1",[e]);if(0===r.rowCount)return null;let n=r.rows[0];if(!await l().compare(t,n.password_hash))return null;return{id:n.id,username:n.username,role:n.role,full_name:n.full_name}}catch(e){return console.error("Authentication error:",e),null}}var d=r(6797);let h="force-dynamic",m="nodejs";async function g(e){try{let{username:t,password:r,rememberMe:n}=await e.json();if(!t||!r)return i.Z.json({error:"Thiếu t\xean đăng nhập hoặc mật khẩu"},{status:400});let a=await p(t,r);if(!a)return i.Z.json({error:"T\xean đăng nhập hoặc mật khẩu kh\xf4ng đ\xfang"},{status:401});return(0,d.cookies)().set("session",JSON.stringify(a),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:n?2592e3:86400}),i.Z.json({id:a.id,username:a.username,role:a.role,full_name:a.full_name})}catch(e){return console.error("Login error:",e),i.Z.json({error:"Lỗi m\xe1y chủ nội bộ"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/workspace/shadcn-ui/app/api/auth/login/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:w,headerHooks:j,staticGenerationBailout:q}=y,v="/api/auth/login/route";function k(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:x})}},636:(e,t,r)=>{r.d(t,{I:()=>a});let n=new(require("pg")).Pool({connectionString:"postgresql://username:password@localhost:5432/database_name",ssl:{rejectUnauthorized:!1}});async function a(e,t){let r=await n.connect();try{return await r.query(e,t)}finally{r.release()}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[472,578],()=>r(4695));module.exports=n})();