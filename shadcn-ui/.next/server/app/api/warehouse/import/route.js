"use strict";(()=>{var e={};e.id=676,e.ids=[676],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9648:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>x,patchFetch:()=>k,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>f});var o={};r.r(o),r.d(o,{POST:()=>d,dynamic:()=>l,runtime:()=>p});var n=r(9462),a=r(5345),s=r(7143),i=r(2969),u=r(6797),c=r(8354);let l="force-dynamic",p="nodejs";async function d(e){if(!function(){let e=(0,u.cookies)().get("session");if(!e)return null;try{return JSON.parse(e.value)}catch{return null}}())return i.Z.json({error:"Chưa đăng nhập"},{status:401});try{let{bills:t}=await e.json();if(!Array.isArray(t))return i.Z.json({error:"Thiếu bills (mảng)"},{status:400});let r=0;for(let e of t){let{key:t,account:o,provider_id:n,name:a="-",address:s="-",amount_current:i="0",amount_previous:u="0",total:l="0",nhap:p,raw:d={}}=e;if(!t||!o||!n||!p){console.warn("Skipping bill due to missing required fields:",e);continue}let h=await (0,c.I)(`INSERT INTO kho (key, account, provider_id, name, address, amount_current, amount_previous, total, nhapAt, raw) 
         VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) 
         ON CONFLICT (key) DO NOTHING`,[t,o,n,a,s,i,u,l,p,d]);h.rowCount&&h.rowCount>0&&r++}let o=(await (0,c.I)("SELECT COUNT(*) FROM kho WHERE xuatAt IS NULL")).rows[0].count;return i.Z.json({ok:!0,added:r,total:parseInt(o)})}catch(e){return console.error("Warehouse import error:",e),i.Z.json({error:e.message||"Lỗi nhập kho"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/warehouse/import/route",pathname:"/api/warehouse/import",filename:"route",bundlePath:"app/api/warehouse/import/route"},resolvedPagePath:"/workspace/shadcn-ui/app/api/warehouse/import/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:g,headerHooks:y,staticGenerationBailout:f}=h,x="/api/warehouse/import/route";function k(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}},8354:(e,t,r)=>{r.d(t,{I:()=>n});let o=new(require("pg")).Pool({connectionString:"postgresql://username:password@localhost:5432/database_name",ssl:{rejectUnauthorized:!1}});async function n(e,t){let r=await o.connect();try{return await r.query(e,t)}finally{r.release()}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[472,578],()=>r(9648));module.exports=o})();